/*!
 * CustomRequest - Use friendly URLs everywhere
 * Version: 1.3.4
 * Build date: 2022-01-10
 */
var customRequest=function(e){customRequest.superclass.constructor.call(this,e=e||{})};Ext.extend(customRequest,Ext.Component,{initComponent:function(){this.stores={},this.ajax=new Ext.data.Connection({disableCaching:!0})},page:{},window:{},grid:{},tree:{},panel:{},combo:{},config:{},util:{},form:{}}),Ext.reg("customrequest",customRequest),CustomRequest=new customRequest,CustomRequest.combo.Resource=function(e){e=e||{},Ext.applyIf(e,{url:CustomRequest.config.connectorUrl,baseParams:{action:"mgr/resources/getlist",combo:!0},pageSize:10,fields:["id","pagetitle"],displayField:"pagetitle",valueField:"id",lazyRender:!0,editable:!0,typeAhead:!0,minChars:1,forceSelection:!0,triggerAction:"all"}),CustomRequest.combo.Resource.superclass.constructor.call(this,e)},Ext.extend(CustomRequest.combo.Resource,MODx.combo.ComboBox),Ext.reg("customrequest-combo-resource",CustomRequest.combo.Resource),CustomRequest.util.renderHtml=function(e){return MODx.util.safeHtml(e,"<span>")},CustomRequest.panel.Home=function(e){e=e||{},Ext.applyIf(e,{cls:"container home-panel"+(CustomRequest.config.debug?" debug":"")+" modx"+CustomRequest.config.modxversion,defaults:{collapsible:!1,autoHeight:!0},items:[{html:"<h2>"+_("customrequest")+"</h2>"+(CustomRequest.config.debug?'<div class="ribbon top-right"><span>'+_("customrequest.debug_mode")+"</span></div>":""),border:!1,cls:"modx-page-header"},{defaults:{autoHeight:!0},border:!0,cls:"customrequest-panel",items:[{xtype:"customrequest-panel-overview"}]},{cls:"treehillstudio_about",html:'<img width="146" height="40" src="'+CustomRequest.config.assetsUrl+'img/mgr/treehill-studio-small.png" srcset="'+CustomRequest.config.assetsUrl+'img/mgr/treehill-studio-small@2x.png 2x" alt="Treehill Studio">',listeners:{afterrender:function(){this.getEl().select("img").on("click",function(){var e='<span style="display: inline-block; text-align: center"><img src="'+CustomRequest.config.assetsUrl+'img/mgr/treehill-studio.png" srcset="'+CustomRequest.config.assetsUrl+'img/mgr/treehill-studio@2x.png 2x" alt="Treehill Studio"><br>&copy; 2013-2022 by <a href="https://treehillstudio.com" target="_blank">treehillstudio.com</a></span>';Ext.Msg.show({title:_("customrequest")+" "+CustomRequest.config.version,msg:e,buttons:Ext.Msg.OK,cls:"treehillstudio_window",width:358})})}}}]}),CustomRequest.panel.Home.superclass.constructor.call(this,e)},Ext.extend(CustomRequest.panel.Home,MODx.Panel),Ext.reg("customrequest-panel-home",CustomRequest.panel.Home),CustomRequest.panel.HomeTab=function(e){e=e||{},Ext.applyIf(e,{id:"customrequest-panel-"+e.tabtype,title:e.title,items:[{html:"<p>"+e.description+"</p>",border:!1,cls:"panel-desc"},{layout:"form",cls:"x-form-label-left main-wrapper",defaults:{autoHeight:!0},border:!0,items:[{id:"customrequest-panel-"+e.tabtype+"-grid",xtype:"customrequest-grid-"+e.tabtype,preventRender:!0}]}]}),CustomRequest.panel.HomeTab.superclass.constructor.call(this,e)},Ext.extend(CustomRequest.panel.HomeTab,MODx.Panel),Ext.reg("customrequest-panel-hometab",CustomRequest.panel.HomeTab),CustomRequest.panel.Overview=function(e){e=e||{},this.ident="customrequest-panel-overview"+Ext.id(),this.panelOverviewTabs=[{xtype:"customrequest-panel-hometab",title:_("customrequest.configs"),description:_("customrequest.configs_desc"),tabtype:"configs"}],CustomRequest.config.is_admin&&this.panelOverviewTabs.push({xtype:"customrequest-panel-settings"}),Ext.applyIf(e,{id:this.ident,items:[{xtype:"modx-tabs",border:!0,stateful:!0,stateId:"customrequest-panel-overview",stateEvents:["tabchange"],getState:function(){return{activeTab:this.items.indexOf(this.getActiveTab())}},autoScroll:!0,deferredRender:!1,forceLayout:!0,defaults:{layout:"form",autoHeight:!0,hideMode:"offsets"},items:this.panelOverviewTabs,listeners:{tabchange:function(e,t){"customrequest-panel-settings"===t.xtype?Ext.getCmp("customrequest-grid-system-settings").getStore().reload():"customrequest-panel-hometab"===t.xtype&&Ext.getCmp("customrequest-panel-"+t.tabtype+"-grid")&&Ext.getCmp("customrequest-panel-"+t.tabtype+"-grid").getStore().reload()}}}]}),CustomRequest.panel.Overview.superclass.constructor.call(this,e)},Ext.extend(CustomRequest.panel.Overview,MODx.Panel),Ext.reg("customrequest-panel-overview",CustomRequest.panel.Overview),CustomRequest.grid.Configs=function(e){e=e||{},this.buttonColumnTpl=new Ext.XTemplate('<tpl for="."><tpl if="action_buttons !== null"><ul class="action-buttons"><tpl for="action_buttons"><li><i class="icon {className} icon-{icon}" title="{text}"></i></li></tpl></ul></tpl></tpl>',{compiled:!0}),this.ident=e.ident||"customrequest-configs"+Ext.id(),Ext.applyIf(e,{id:"customrequest-grid-configs",url:CustomRequest.config.connectorUrl,baseParams:{action:"mgr/configs/getlist"},fields:["id","name","menuindex","alias","alias_gen","pagetitle","resourceid","context","urlparams","regex"],autoHeight:!0,paging:!0,remoteSort:!1,enableDragDrop:!0,ddGroup:"customrequest-grid-dd",autoExpandColumn:"alias",showActionsColumn:!1,columns:[{header:_("customrequest.configs_name"),dataIndex:"name",width:100},{header:_("customrequest.configs_alias"),dataIndex:"alias_gen",renderer:CustomRequest.util.renderHtml,width:150},{header:_("customrequest.configs_resourceid"),dataIndex:"pagetitle",width:80},{header:_("customrequest.configs_context"),dataIndex:"context",width:80},{header:_("id"),dataIndex:"id",hidden:!0,width:20},{renderer:{fn:this.buttonColumnRenderer,scope:this},menuDisabled:!0,width:20}],tbar:[{text:_("customrequest.configs_create"),cls:"primary-button",handler:this.createConfig},"->",{xtype:"textfield",id:this.ident+"-config-filter-search",emptyText:_("search")+"â€¦",submitValue:!1,listeners:{change:{fn:this.search,scope:this},render:{fn:function(e){new Ext.KeyMap(e.getEl(),{key:Ext.EventObject.ENTER,fn:function(){return this.fireEvent("change",this),this.blur(),!0},scope:e})},scope:this}}},{xtype:"button",id:this.ident+"-config-filter-clear",cls:"x-form-filter-clear",text:_("filter_clear"),listeners:{click:{fn:this.clearFilter,scope:this}}}],listeners:{render:{fn:this.renderListener,scope:this}}}),CustomRequest.grid.Configs.superclass.constructor.call(this,e)},Ext.extend(CustomRequest.grid.Configs,MODx.grid.Grid,{windows:{},getMenu:function(){var e=[];e.push({text:_("customrequest.configs_update"),handler:this.updateConfig}),e.push("-"),e.push({text:_("customrequest.configs_remove"),handler:this.removeConfig}),this.addContextMenuItem(e)},createConfig:function(e,t){this.createUpdateConfig(e,t,!1)},updateConfig:function(e,t){this.createUpdateConfig(e,t,!0)},createUpdateConfig:function(e,t,s){var o;if(s){if(!this.menu.record||!this.menu.record.id)return!1;o=this.menu.record}else o={};s=MODx.load({xtype:"customrequest-window-config-create-update",isUpdate:s,title:s?_("customrequest.configs_update"):_("customrequest.configs_create"),record:o,listeners:{success:{fn:this.refresh,scope:this}}});s.fp.getForm().setValues(o),s.show(t.target)},removeConfig:function(){if(!this.menu.record)return!1;MODx.msg.confirm({title:_("customrequest.configs_remove"),text:_("customrequest.configs_remove_confirm"),url:this.config.url,params:{action:"mgr/configs/remove",id:this.menu.record.id},listeners:{success:{fn:this.refresh,scope:this}}})},search:function(e){this.getStore().baseParams.query=e.getValue(),this.getBottomToolbar().changePage(1),this.refresh()},clearFilter:function(){this.getStore().baseParams.query="",Ext.getCmp(this.ident+"-config-filter-search").reset(),this.getBottomToolbar().changePage(1),this.refresh()},renderListener:function(a){new Ext.dd.DropTarget(a.container,{ddGroup:"customrequest-grid-dd",notifyDrop:function(e,t,s){var o=a.store,i=a.getSelectionModel(),r=i.getSelections(),e=e.getDragData(t);if(e){t=e.rowIndex;if(void 0!==t){for(var e=o.getAt(t),n=[],u=0;u<r.length;u++)o.remove(o.getById(r[u].id)),n.push(r[u].id);return o.insert(t,s.selections),i.clearSelections(),a.sortIndex(e.id,n),!0}}a.getView().refresh()}})},sortIndex:function(e,t){MODx.Ajax.request({url:CustomRequest.config.connectorUrl,params:{action:"mgr/configs/sortindex",targetId:e,movingIds:t.join()},listeners:{success:{fn:this.refresh,scope:this}}})},buttonColumnRenderer:function(){var e={action_buttons:[{className:"update",icon:"pencil-square-o",text:_("customrequest.configs_update")},{className:"remove",icon:"trash-o",text:_("customrequest.configs_remove")}]};return this.buttonColumnTpl.apply(e)},onClick:function(e){var t=e.getTarget();if("icon"===t.className.split(" ")[0]){var t=t.className.split(" ")[1],s=this.getSelectionModel().getSelected();switch(this.menu.record=s.data,t){case"remove":this.removeConfig(s,e);break;case"update":this.updateConfig(s,e)}}}}),Ext.reg("customrequest-grid-configs",CustomRequest.grid.Configs),CustomRequest.window.CreateUpdateConfig=function(e){this.ident=(e=e||{}).ident||"customrequest-mecitem"+Ext.id(),Ext.applyIf(e,{id:this.ident,url:CustomRequest.config.connectorUrl,action:e.isUpdate?"mgr/configs/update":"mgr/configs/create",autoHeight:!0,closeAction:"close",cls:"modx-window customrequest-window modx"+ConsentFriend.config.modxversion,fields:[{xtype:"textfield",fieldLabel:_("customrequest.configs_name"),name:"name",id:this.ident+"-name",anchor:"100%"},{xtype:"textfield",fieldLabel:_("customrequest.configs_alias"),description:_("customrequest.configs_alias_desc"),name:"alias",id:this.ident+"-alias",anchor:"100%"},{xtype:"customrequest-combo-resource",fieldLabel:_("customrequest.configs_resourceid"),description:_("customrequest.configs_resourceid_desc"),name:"resourceid",hiddenName:"resourceid",id:this.ident+"-resourceid",anchor:"100%"},{xtype:"textarea",fieldLabel:_("customrequest.configs_urlparams"),description:_("customrequest.configs_urlparams_desc"),name:"urlparams",id:this.ident+"-urlparams",anchor:"100%"},{xtype:"textarea",fieldLabel:_("customrequest.configs_regex"),description:_("customrequest.configs_regex_desc"),name:"regex",id:this.ident+"-regex",anchor:"100%"},{xtype:"hidden",name:"id",id:this.ident+"-id"}],listeners:{render:function(e){Ext.create("Ext.tip.QuickTip",{target:e.getEl()})}}}),CustomRequest.window.CreateUpdateConfig.superclass.constructor.call(this,e)},Ext.extend(CustomRequest.window.CreateUpdateConfig,MODx.Window),Ext.reg("customrequest-window-config-create-update",CustomRequest.window.CreateUpdateConfig),CustomRequest.panel.Settings=function(e){e=e||{},Ext.applyIf(e,{id:"customrequest-panel-settings",title:_("customrequest.settings"),items:[{html:"<p>"+_("customrequest.settings_desc")+"</p>",border:!1,cls:"panel-desc"},{xtype:"customrequest-grid-system-settings",id:"customrequest-grid-system-settings",cls:"main-wrapper",preventSaveRefresh:!0}]}),CustomRequest.panel.Settings.superclass.constructor.call(this,e)},Ext.extend(CustomRequest.panel.Settings,MODx.Panel),Ext.reg("customrequest-panel-settings",CustomRequest.panel.Settings),CustomRequest.grid.SystemSettings=function(e){e=e||{},Ext.applyIf(e,{id:"customrequest-grid-systemsettings",url:CustomRequest.config.connectorUrl,baseParams:{action:"mgr/settings/getlist",area:MODx.request.area||""},save_action:"mgr/settings/updatefromgrid",tbar:[],queryParam:3<=CustomRequest.config.modxversion?"query":"key"}),CustomRequest.grid.SystemSettings.superclass.constructor.call(this,e)},Ext.extend(CustomRequest.grid.SystemSettings,MODx.grid.SettingsGrid,{_showMenu:function(e,t,s){s.stopEvent(),s.preventDefault(),this.menu.record=this.getStore().getAt(t).data,this.getSelectionModel().isSelected(t)||this.getSelectionModel().selectRow(t),this.menu.removeAll();t=[];this.menu.record.menu?t=this.menu.record.menu:t.push({text:_("setting_update")||_("edit"),handler:this.updateSetting}),0<t.length&&(this.addContextMenuItem(t),this.menu.showAt(s.xy))},updateSetting:function(e,t){var s=this.menu.record;s.fk=Ext.isDefined(this.config.fk)?this.config.fk:0;var o=MODx.load({xtype:"modx-window-setting-update",url:CustomRequest.config.connectorUrl,action:"mgr/settings/update",record:s,grid:this,listeners:{success:{fn:function(){this.refresh()},scope:this}}});o.reset(),o.setValues(s),o.show(t.target)},clearFilter:function(){var e=MODx.request.area||"";this.getStore().baseParams=this.initialConfig.baseParams;var t=Ext.getCmp("modx-filter-area");t&&(t.store.load(),t.reset()),Ext.getCmp("modx-filter-"+this.config.queryParam).reset(),this.getStore().baseParams.area=e,this.getStore().baseParams[this.config.queryParam]="",this.getBottomToolbar().changePage(1)},filterByKey:function(e,t){return this.getStore().baseParams[this.config.queryParam]=t,this.getBottomToolbar().changePage(1),!0},filterByNamespace:function(){this.getStore().baseParams.area="",this.getBottomToolbar().changePage(1);var e,t=Ext.getCmp("modx-filter-area");t&&((e=t.store).removeAll(),e.load(),t.setValue(""))},listeners:{afterrender:function(){Ext.getCmp("modx-filter-namespace").hide()}}}),Ext.reg("customrequest-grid-system-settings",CustomRequest.grid.SystemSettings),CustomRequest.page.Home=function(e){e=e||{},Ext.applyIf(e,{formpanel:"customrequest-panel-home",components:[{xtype:"customrequest-panel-home"}]}),CustomRequest.page.Home.superclass.constructor.call(this,e)},Ext.extend(CustomRequest.page.Home,MODx.Component),Ext.reg("customrequest-page-home",CustomRequest.page.Home);